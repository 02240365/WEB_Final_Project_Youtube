{"ast":null,"code":"\"use client\";import{useState,useEffect}from\"react\";import{useParams}from\"react-router-dom\";import\"./VideoPage.css\";import VideoPlayer from\"../components/videos/VideoPlayer\";import CommentSection from\"../components/comments/CommentSection\";import VideoCard from\"../components/videos/VideoCard\";import{fetchVideoById,fetchRelatedVideos,likeVideo,subscribeToChannel,fetchVideoComments,addComment}from\"../services/api\";import{useAuth}from\"../context/AuthContext\";import{toast}from\"react-toastify\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function VideoPage(){const{id}=useParams();const{user,currentUser}=useAuth();const authUser=user||currentUser;const[video,setVideo]=useState(null);const[relatedVideos,setRelatedVideos]=useState([]);const[comments,setComments]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[isLiked,setIsLiked]=useState(false);const[isDisliked,setIsDisliked]=useState(false);const[isSubscribed,setIsSubscribed]=useState(false);// Load video data\nuseEffect(()=>{if(id){loadVideoData();loadComments();}},[id]);const loadVideoData=async()=>{try{setLoading(true);setError(null);console.log(\"Loading video with ID:\",id);// Fetch main video\nconst videoData=await fetchVideoById(id);console.log(\"Video data received:\",videoData);setVideo(videoData);// Fetch related videos\ntry{const relatedData=await fetchRelatedVideos(id);setRelatedVideos(relatedData||[]);}catch(relatedError){console.error(\"Error loading related videos:\",relatedError);setRelatedVideos([]);}}catch(error){console.error(\"Error loading video:\",error);setError(\"Failed to load video. Please try again.\");toast.error(\"Failed to load video\");}finally{setLoading(false);}};const loadComments=async()=>{try{const commentsData=await fetchVideoComments(id);setComments(commentsData||[]);}catch(error){console.error(\"Error loading comments:\",error);setComments([]);}};const handleAddComment=async commentText=>{try{const newComment=await addComment(id,commentText);setComments(prev=>[newComment,...prev]);toast.success(\"Comment added!\");}catch(error){console.error(\"Error adding comment:\",error);throw error;}};// Handle like/dislike\nconst handleLike=async isLike=>{if(!authUser){toast.error(\"Please log in to like videos\");return;}try{await likeVideo(id,isLike);if(isLike){setIsLiked(!isLiked);setIsDisliked(false);}else{setIsDisliked(!isDisliked);setIsLiked(false);}toast.success(isLike?\"Video liked!\":\"Video disliked!\");}catch(error){console.error(\"Error liking video:\",error);toast.error(\"Failed to like video\");}};// Handle subscribe\nconst handleSubscribe=async()=>{var _video$channel;if(!authUser){toast.error(\"Please log in to subscribe\");return;}if(!(video!==null&&video!==void 0&&(_video$channel=video.channel)!==null&&_video$channel!==void 0&&_video$channel.id)){toast.error(\"Channel information not available\");return;}try{await subscribeToChannel(video.channel.id,!isSubscribed);setIsSubscribed(!isSubscribed);toast.success(isSubscribed?\"Unsubscribed!\":\"Subscribed!\");}catch(error){console.error(\"Error subscribing:\",error);toast.error(\"Failed to subscribe\");}};// Format numbers (views, likes, etc.)\nconst formatNumber=num=>{if(!num)return\"0\";if(num>=1000000){return\"\".concat((num/1000000).toFixed(1),\"M\");}else if(num>=1000){return\"\".concat((num/1000).toFixed(1),\"K\");}return num.toString();};// Format date\nconst formatDate=dateString=>{if(!dateString)return\"Unknown date\";const date=new Date(dateString);return date.toLocaleDateString(\"en-US\",{year:\"numeric\",month:\"long\",day:\"numeric\"});};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"video-page\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"video-page__loading\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"video-page__loading-spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading video...\"})]})});}if(error||!video){return/*#__PURE__*/_jsx(\"div\",{className:\"video-page\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"video-page__error\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Video not found\"}),/*#__PURE__*/_jsx(\"p\",{children:error||\"The video you're looking for doesn't exist.\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.history.back(),className:\"video-page__back-btn\",children:\"Go Back\"})]})});}return/*#__PURE__*/_jsx(\"div\",{className:\"video-page\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"video-page__content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"video-page__main\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"video-page__player\",children:/*#__PURE__*/_jsx(VideoPlayer,{videoUrl:video.videoUrl,thumbnailUrl:video.thumbnailUrl,title:video.title})}),/*#__PURE__*/_jsxs(\"div\",{className:\"video-page__info\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"video-page__title\",children:video.title}),/*#__PURE__*/_jsxs(\"div\",{className:\"video-page__meta\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"video-page__stats\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"video-page__views\",children:[formatNumber(video.views),\" views\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"video-page__date\",children:[\"\\u2022 \",formatDate(video.createdAt)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"video-page__actions\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"video-page__action-btn \".concat(isLiked?\"video-page__action-btn--active\":\"\"),onClick:()=>handleLike(true),children:[/*#__PURE__*/_jsx(\"span\",{className:\"video-page__action-icon\",children:\"\\uD83D\\uDC4D\"}),/*#__PURE__*/_jsx(\"span\",{children:formatNumber(video.likes)})]}),/*#__PURE__*/_jsxs(\"button\",{className:\"video-page__action-btn \".concat(isDisliked?\"video-page__action-btn--active\":\"\"),onClick:()=>handleLike(false),children:[/*#__PURE__*/_jsx(\"span\",{className:\"video-page__action-icon\",children:\"\\uD83D\\uDC4E\"}),/*#__PURE__*/_jsx(\"span\",{children:formatNumber(video.dislikes)})]}),/*#__PURE__*/_jsxs(\"button\",{className:\"video-page__action-btn\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"video-page__action-icon\",children:\"\\u2197\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Share\"})]}),/*#__PURE__*/_jsx(\"button\",{className:\"video-page__action-btn\",children:/*#__PURE__*/_jsx(\"span\",{className:\"video-page__action-icon\",children:\"\\u22EF\"})})]})]})]}),video.channel&&/*#__PURE__*/_jsxs(\"div\",{className:\"video-page__channel\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"video-page__channel-info\",children:[/*#__PURE__*/_jsx(\"img\",{src:video.channel.profilePicture||\"/placeholder.svg\",alt:video.channel.name,className:\"video-page__channel-avatar\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"video-page__channel-details\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"video-page__channel-name\",children:[video.channel.name,video.channel.verified&&/*#__PURE__*/_jsx(\"span\",{className:\"video-page__verified\",children:\"\\u2713\"})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"video-page__channel-subscribers\",children:[formatNumber(video.channel.subscribers),\" subscribers\"]})]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"video-page__subscribe-btn \".concat(isSubscribed?\"video-page__subscribe-btn--subscribed\":\"\"),onClick:handleSubscribe,children:isSubscribed?\"Subscribed\":\"Subscribe\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"video-page__description\",children:/*#__PURE__*/_jsx(\"div\",{className:\"video-page__description-content\",children:/*#__PURE__*/_jsx(\"p\",{children:video.description||\"No description available.\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"video-page__comments\",children:/*#__PURE__*/_jsx(CommentSection,{videoId:id,comments:comments,onAddComment:handleAddComment})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"video-page__sidebar\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"video-page__sidebar-title\",children:\"Related Videos\"}),/*#__PURE__*/_jsx(\"div\",{className:\"video-page__related-videos\",children:relatedVideos.length>0?relatedVideos.map(relatedVideo=>/*#__PURE__*/_jsx(VideoCard,{video:relatedVideo,channelData:relatedVideo.channel,layout:\"list\"},relatedVideo.id)):/*#__PURE__*/_jsx(\"p\",{className:\"video-page__no-related\",children:\"No related videos found.\"})})]})]})});}export default VideoPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}